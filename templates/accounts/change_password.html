{% extends 'base.html' %}

{% block title %}Changer mon mot de passe{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">Changer mon mot de passe</h4>
                    <a href="{% url 'profile_edit' %}" class="btn btn-sm btn-outline-secondary">
                        ← Retour
                    </a>
                </div>
            </div>
            <div class="card-body">
                <form method="post" novalidate>
                    {% csrf_token %}
                    
                    {% if form.errors %}
                        <div class="alert alert-danger">
                            <strong>Veuillez corriger les erreurs ci-dessous:</strong>
                            <ul>
                                {% for field, errors in form.errors.items %}
                                    {% for error in errors %}
                                        <li>{{ field|title }}: {{ error }}</li>
                                    {% endfor %}
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                    
                    <div class="mb-3">
                        <label for="id_old_password" class="form-label">Ancien mot de passe *</label>
                        <input type="password" name="old_password" class="form-control" 
                               id="id_old_password" required autofocus>
                    </div>
                    
                    <div class="mb-3">
                        <label for="id_new_password1" class="form-label">Nouveau mot de passe *</label>
                        <input type="password" name="new_password1" class="form-control" 
                               id="id_new_password1" required>
                        <div class="form-text">
                            <ul class="small mb-0">
                                <li>Votre mot de passe ne peut pas trop ressembler à vos autres informations personnelles.</li>
                                <li>Votre mot de passe doit contenir au minimum 8 caractères.</li>
                                <li>Votre mot de passe ne peut pas être un mot de passe couramment utilisé.</li>
                                <li>Votre mot de passe ne peut pas être entièrement numérique.</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="id_new_password2" class="form-label">Confirmation du nouveau mot de passe *</label>
                        <input type="password" name="new_password2" class="form-control" 
                               id="id_new_password2" required>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'profile_edit' %}" class="btn btn-secondary">Annuler</a>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Changer le mot de passe
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Ajouter la fonctionnalité pour afficher/masquer les mots de passe
    const passwordFields = [
        document.getElementById('id_old_password'),
        document.getElementById('id_new_password1'),
        document.getElementById('id_new_password2')
    ];
    
    passwordFields.forEach(field => {
        if (field) {
            const toggleBtn = document.createElement('button');
            toggleBtn.type = 'button';
            toggleBtn.className = 'btn btn-outline-secondary btn-sm position-absolute';
            toggleBtn.style.right = '10px';
            toggleBtn.style.top = '50%';
            toggleBtn.style.transform = 'translateY(-50%)';
            toggleBtn.innerHTML = '<i class="bi bi-eye"></i>';
            
            const parentDiv = field.parentElement;
            parentDiv.style.position = 'relative';
            field.style.paddingRight = '50px';
            parentDiv.appendChild(toggleBtn);
            
            toggleBtn.addEventListener('click', function() {
                const type = field.getAttribute('type') === 'password' ? 'text' : 'password';
                field.setAttribute('type', type);
                this.innerHTML = type === 'password' ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
            });
        }
    });
});
</script>
{% endblock %}